{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{chatService}from'../services/chatService';import{useAuth}from'../App';import{toast}from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Chat=_ref=>{let{contextType,contextId}=_ref;const{user}=useAuth();const[messages,setMessages]=useState([]);const[input,setInput]=useState('');const wsRef=useRef(null);useEffect(()=>{const token=localStorage.getItem('auth_token');let ws;async function init(){try{const msgs=await chatService.getMessages(contextType,contextId);setMessages(msgs);ws=chatService.connectWebSocket(contextType,contextId,token,msg=>{setMessages(prev=>[...prev,msg]);if(msg.sender_id!==(user===null||user===void 0?void 0:user.id)){toast(\"Nouveau message de \".concat(msg.sender_handle));}});wsRef.current=ws;}catch(err){console.error('Failed to load chat',err);}}init();return()=>{if(wsRef.current)wsRef.current.close();};},[contextType,contextId,user]);const send=async e=>{e.preventDefault();if(!input.trim())return;try{await chatService.postMessage(contextType,contextId,input.trim());setInput('');}catch(err){toast.error('Envoi échoué');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded p-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-64 overflow-y-auto mb-4\",children:messages.map(m=>/*#__PURE__*/_jsxs(\"div\",{className:\"mb-1\",children:[/*#__PURE__*/_jsx(\"strong\",{children:m.sender_handle}),\": \",m.content]},m.id))}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:send,className:\"flex gap-2\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"flex-1 border p-1 text-black bg-white\",value:input,onChange:e=>setInput(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"bg-blue-500 text-white px-3\",children:\"Envoyer\"})]})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useRef","chatService","useAuth","toast","jsx","_jsx","jsxs","_jsxs","Chat","_ref","contextType","contextId","user","messages","setMessages","input","setInput","wsRef","token","localStorage","getItem","ws","init","msgs","getMessages","connectWebSocket","msg","prev","sender_id","id","concat","sender_handle","current","err","console","error","close","send","e","preventDefault","trim","postMessage","className","children","map","m","content","onSubmit","value","onChange","target","type"],"sources":["C:/Users/Knight-Server/Desktop/VerseLink-conflict_090925_1049/frontend/src/components/Chat.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { chatService } from '../services/chatService';\r\nimport { useAuth } from '../App';\r\nimport { toast } from 'react-hot-toast';\r\n\r\nconst Chat = ({ contextType, contextId }) => {\r\n  const { user } = useAuth();\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState('');\r\n  const wsRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('auth_token');\r\n    let ws;\r\n    async function init() {\r\n      try {\r\n        const msgs = await chatService.getMessages(contextType, contextId);\r\n        setMessages(msgs);\r\n        ws = chatService.connectWebSocket(contextType, contextId, token, (msg) => {\r\n          setMessages((prev) => [...prev, msg]);\r\n          if (msg.sender_id !== user?.id) {\r\n            toast(`Nouveau message de ${msg.sender_handle}`);\r\n          }\r\n        });\r\n        wsRef.current = ws;\r\n      } catch (err) {\r\n        console.error('Failed to load chat', err);\r\n      }\r\n    }\r\n    init();\r\n    return () => { if (wsRef.current) wsRef.current.close(); };\r\n  }, [contextType, contextId, user]);\r\n\r\n  const send = async (e) => {\r\n    e.preventDefault();\r\n    if (!input.trim()) return;\r\n    try {\r\n      await chatService.postMessage(contextType, contextId, input.trim());\r\n      setInput('');\r\n    } catch (err) {\r\n      toast.error('Envoi échoué');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"border rounded p-4\">\r\n      <div className=\"h-64 overflow-y-auto mb-4\">\r\n        {messages.map(m => (\r\n          <div key={m.id} className=\"mb-1\">\r\n            <strong>{m.sender_handle}</strong>: {m.content}\r\n          </div>\r\n        ))}\r\n      </div>\r\n        <form onSubmit={send} className=\"flex gap-2\">\r\n          <input\r\n            className=\"flex-1 border p-1 text-black bg-white\"\r\n            value={input}\r\n            onChange={e => setInput(e.target.value)}\r\n          />\r\n          <button type=\"submit\" className=\"bg-blue-500 text-white px-3\">Envoyer</button>\r\n        </form>\r\n      </div>\r\n    );\r\n  };\r\n\r\nexport default Chat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}